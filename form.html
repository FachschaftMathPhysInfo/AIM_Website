<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Anmeldung &middot; fAIM</title>
    <script src="jquery-3.5.1.min.js"></script>
    <script src="jquery-ui-1.12.1.js"></script>
    <link rel="icon" type="image/png" href="favicon.png" />
    <link rel="stylesheet" href="bulma-0.9.1.min.css">
    <link rel="stylesheet" href="jquery-ui.css">
    <link rel="stylesheet" href="styles.css">
    <style type="text/css">
    #total-form {
        margin-top: 2em;
        margin-bottom: 2em;
    }

    .time-cols div {
        padding-top: 2px;
        padding-bottom: 2px;
    }

    #sliderval {
        font-size: 0.9em;
        padding-right: 2em;
    }
    .particips {
        color: #aaaaaa;
        padding-left: 1em;
    }
    </style>
    <script>
    function fieldOptions() {
    $.getJSON( "fields.json", function( data ) {
        var items = [];
        $.each( data.fields, function( key, obj ) {
            $( "#select-field" ).append( "<option value='" + key + "'>" + obj.name.de + "</option>" );
        });
        //$( "<div/>", { html: items.join( "" ) }).appendTo( "#fields" );
    });
    }

    // Get ID (token) from URL
    function getID() {
        var url = window.location.href;
        var match1 = url.match(/\?token\=[A-Za-z0-9]+/gi);
        if (match1 == null) {
            match1 = url.match(/\&token\=[A-Za-z0-9]+/gi);
        }

        if (match1 != null) {
            match1 = match1[0];
            var id = match1.replace(/(\&|\?)token\=/gi,'');
            return id;
        }
        else {
            return null;
        }
    }

    // Check whether token is valid
    function checkID(id, data) {
        var rstrs = data.split('\n');
        var res = rstrs.find(function(rstrs) {
            return rstrs == id;
        });
        if (res == undefined) {
            // ID not found
            $( '#total-form' ).html('<p>Falscher Token oder Token bereits genutzt – bitte wenden Sie sich an <a href="mailto:fachschaft@mathphys.stura.uni-heidelberg.de">fachschaft@mathphys.stura.uni-heidelberg.de</a>, um bei Bedarf einen neuen zu erhalten.</p>')
        }
    }

    var useTokens = false;
    if (useTokens) {
        $( document ).ready(function() {
            var id = getID();
            $.get('r_strings.txt', function(data) {
                checkID(id,data);
            });

            $('#token').attr('value', id);
        });
    }

    $("#image-upload").change(function(){
        //alert(this.files[0].name);
        $("#image-name").text(this.files[0].name);
    });

    $( function() {
        $( "#slider" ).slider({
            min: 1,
            max: 5,
            value: 2,
            slide: function( event, ui ) {
                $( "#sliderval" ).text( ui.value );
                $( "#nslots" ).attr('value', ui.value);
            }
        });
    });

    // Get number of dates selected by other groups
    function getTimes(data, fieldID) {
        var times=[0,0,0,0,0];
        // get properties from JSON file
        $.each( data.groups, function( key, obj ) {
            if (obj.field == fieldID) {
                if (obj.hasOwnProperty("times")){
                    var i = 0;
                    obj.times.forEach(function(val) {
                        if (val==1) {
                            times[i]++;
                        }
                        i++;
                    });
                }
            }
        });
        return times;
    }

    </script>
</head>
<body>
<div id="page-content">
<!-- Header -->
<div id="header">
    <div id="title" class="aim-title">
        <h2>Anmeldung zur fAIM</h2>
    </div>
    <div id="welcome">
        <p>Danke für Ihr Interesse an der fern-ArbeitsgruppenInspitationsMesse! Hier können Sie sich anmelden und die Informationen eingeben, die auf der <a href="index.html">Website</a> gelistet werden.</p>
        <p>Wir freuen uns auf Ihre Teilnahme!</p> <p>Die <a href="https://mathphys.info">Fachschaft MathPhysInfo</a></p>
        <hr />
        <p>Thank you for your interest in the Working Group Fair (fAIM). Here, you can register and enter the information for display on our <a href="index.html">website</a>.</p>
        <p>We're looking forward to your participiation.</p> <p>The <a href="https://mathphys.stura.uni-heidelberg.de/w/en/welcome-at-the-students-council/">Fachschaft MathPhysInfo</a></p>
        <hr />
        <p style="text-align: right;"><strong>&rarr; <a href="arbeitsgruppen.html" target="agfaq">Informationen & FAQ für Arbeitsgruppen</a></strong></p>
    </div>
</div>
<!-- Overview of reasearch fields -->
<form action="form_submit.php" method="post" id="main-form" enctype="multipart/form-data">
<div id="total-form">
    <div class="field is-horizontal">
        <div class="field-label is-normal">
            <label class="label">Gruppenname</label>
        </div>
        <div class="field-body">
            <div class="field">
                <div class="control">
                    <input class="input" type="text" placeholder="Gruppenname / group name" name="name" required>
                </div>
            </div>
        </div>
    </div>

    <div class="field is-horizontal">
        <div class="field-label is-normal">
            <label class="label">Themenfeld</label>
        </div>
        <div class="field-body">
            <div class="field">
                <div class="control">
                    <div class="select">
                        <select id="select-field" name="field" required>
                            <option></option>
                            <script>fieldOptions();</script>
                        </select>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
    $( "#select-field" ).change(function() {
        var fieldID = $( "#select-field option:selected" ).val();
        //alert(fieldID);
        $.getJSON( "groups_stub.json", function( data ) {
            var times = getTimes(data,fieldID);
            $( ".particips" ).each(function( index ) {
                $( this ).text("("+times[index]+")");
                //console.log( index + ": " + $( this ).text() );
            });
        });
    });
    </script>

    <div class="field is-horizontal">
        <div class="field-label is-normal">
            <label class="label">E-Mail</label>
        </div>
        <div class="field-body">
            <div class="field">
                <div class="control">
                    <input class="input" type="text" placeholder="Contact e-mail" name="contact" required>
                </div>
            </div>
        </div>
    </div>

    <div class="field is-horizontal">
        <div class="field-label is-normal">
            <label class="label">Gruppenleiter(innen)</label>
        </div>
        <div class="field-body">
            <div class="field">
                <div class="control">
                    <input class="input" type="text" placeholder="PIs, e.g. Prof. James Bond, PD Dr. No" name="profs" required>
                </div>
            </div>
        </div>
    </div>

    <div class="field is-horizontal">
        <div class="field-label is-normal">
            <label class="label">Gruppenwebsite</label>
        </div>
        <div class="field-body">
            <div class="field">
                <div class="control">
                    <input class="input" type="text" placeholder="Website" name="website">
                </div>
            </div>
        </div>
    </div>
      
      <div class="field is-horizontal">
        <div class="field-label">
          <!-- Left empty for spacing -->
        </div>
        <div class="field-body">
          <div class="field">
            <div class="file has-name">
                <label class="file-label" id="image-upload">
                  <input class="file-input" type="file" name="fileToUpload">
                  <span class="file-cta">
                    <span class="file-icon">
                      <i class="fas fa-upload"></i>
                    </span>
                    <span class="file-label">
                      Bild / Image
                    </span>
                  </span>
                  <span class="file-name" id="image-name">
                    Choose a file… (max. 3 MB)
                  </span>
                </label>
              </div>
          </div>
        </div>
      </div>

      <div class="field is-horizontal">
        <div class="field-label"></div>
        <div class="field-body">
            <div class="field">
                <label class="label">Kurze Beschreibung der Arbeitsgruppe (deutsch)</label>
                <div class="control">
                    <textarea class="textarea" placeholder="Beschreibung auf Deutsch" name="desc-de"></textarea>
                </div>
            </div>
        </div>
    </div>

    <div class="field is-horizontal">
        <div class="field-label"></div>
        <div class="field-body">
            <div class="field">
                <label class="label">Short description of the group (English)</label>
                <div class="control">
                    <textarea class="textarea" placeholder="Description in English" name="desc-en"></textarea>
                </div>
            </div>
        </div>
    </div>

    <div class="field is-horizontal">
        <div class="field-label is-normal">
            <label class="label">Präferierte Zeitslots<br />(min. 1)</label>
        </div>
        <div class="field-body">
            <div class="field">
                <div class="control">
                    <div class="columns time-cols">
                        <div class="column is-1-desktop is-2-mobile has-text-centered"><p>Ja</p></div>
                        <div class="column is-1-desktop is-2-mobile has-text-centered"><p>Vielleicht</p></div>
                        <div class="column is-1-desktop is-2-mobile has-text-centered"><p>Nein</p></div>
                        <div class="column"></div>
                    </div>
                    <div class="columns time-cols">
                        <div class="column is-1-desktop is-2-mobile has-text-centered"><input type="radio" name="time1" value="1" required></div>
                        <div class="column is-1-desktop is-2-mobile has-text-centered"><p><input type="radio" name="time1" value="2"></p></div>
                        <div class="column is-1-desktop is-2-mobile has-text-centered"><input type="radio" name="time1" value="0"></div>
                        <div class="column"><p>14:00 &ndash; 14:45 <span class="particips">(0)</span></p></div>
                    </div>
                    <div class="columns time-cols">
                        <div class="column is-1-desktop is-2-mobile has-text-centered"><input type="radio" name="time2" value="1" required></div>
                        <div class="column is-1-desktop is-2-mobile has-text-centered"><p><input type="radio" name="time2" value="2"></p></div>
                        <div class="column is-1-desktop is-2-mobile has-text-centered"><input type="radio" name="time2" value="0"></div>
                        <div class="column"><p>14:45 &ndash; 15:30 <span class="particips">(0)</span></p></div>
                    </div>
                    <div class="columns time-cols">
                        <div class="column is-1-desktop is-2-mobile has-text-centered"><input type="radio" name="time3" value="1" required></div>
                        <div class="column is-1-desktop is-2-mobile has-text-centered"><p><input type="radio" name="time3" value="2"></p></div>
                        <div class="column is-1-desktop is-2-mobile has-text-centered"><input type="radio" name="time3" value="0"></div>
                        <div class="column"><p>15:30 &ndash; 16:15 <span class="particips">(0)</span></p></div>
                    </div>
                    <div class="columns time-cols">
                        <div class="column is-1-desktop is-2-mobile has-text-centered"><input type="radio" name="time4" value="1" required></div>
                        <div class="column is-1-desktop is-2-mobile has-text-centered"><p><input type="radio" name="time4" value="2"></p></div>
                        <div class="column is-1-desktop is-2-mobile has-text-centered"><input type="radio" name="time4" value="0"></div>
                        <div class="column"><p>16:15 &ndash; 17:00 <span class="particips">(0)</span></p></div>
                    </div>
                    <div class="columns time-cols">
                        <div class="column is-1-desktop is-2-mobile has-text-centered"><input type="radio" name="time5" value="1" required></div>
                        <div class="column is-1-desktop is-2-mobile has-text-centered"><p><input type="radio" name="time5" value="2"></p></div>
                        <div class="column is-1-desktop is-2-mobile has-text-centered"><input type="radio" name="time5" value="0"></div>
                        <div class="column"><p>17:00 &ndash; 17:45 <span class="particips">(0)</span></p></div>
                    </div>
                    <div class="columns">
                        <div class="column is-2-desktop is-6-mobile has-text-centered"><div id="slider"></div> </div>
                        <!-- <div class="column is-1-desktop is-1-mobile has-text-centered"><input class="input is-small" type="text" id="sliderval" value="1" size="1" readonly></div> -->
                        <div class="column"><p><span id="sliderval">2</span> Gewünschte Slots insgesamt</p></div>
                        <input name="nslots" type="hidden" id="nslots" value="2">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="field is-horizontal">
        <div class="field-label"></div>
        <div class="field-body">
            <div class="field">
                <div class="control">
                    <button class="button is-danger">Absenden</button>
                </div>
            </div>
        </div>
    </div>

    <input name="token" type="hidden" id="token">
</div>
</form>
    <div class="is-full" id="textfoot">
        <p>&copy; Fachschaft MathPhysInfo 2021 &middot; <a href="impressum.html">Impressum</a> &middot; <a href="kontakt.html">Kontakt</a></p>
    </div>
</div>
</body>
</html>